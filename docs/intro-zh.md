## XSched: 为异构计算打造通用、灵活的操作系统级抢占式调度器

[English](intro-en.md) | [中文](intro-zh.md)

我们发表在 OSDI '25 上的工作 **XSched**，目前已在 GitHub 开源！🚀

我们正处在一个“计算单元大爆炸”的时代：从云端到边缘，NVIDIA、AMD、Intel、昇腾等厂商的 GPU、NPU、ASIC 等各类异构加速器（XPU）被广泛部署。然而，对于这些宝贵算力的管理和调度机制还普遍停留在“史前时代”。传统的 XPU 硬件调度器策略固化、不可抢占，难以满足实时性、优先级、公平性等灵活的场景需求。而现有的软件调度方案是为单一 XPU 特化的，难以泛用到不同类型、不同品牌、甚至是不同世代的 XPU 上。我们的愿景很简单：**让 XPU 调度像今天的 CPU 调度一样，拥有极致的灵活性、通用性和可编程性。**



为了驯服这些异构算力，我们没有为每一种硬件重复造轮子，而是从根源上提出了两个核心创新：

1️⃣ 统一的可抢占命令队列抽象 XQueue 💡

XQueue 是一个类似于操作系统“线程”的 XPU 任务抽象。它提供了一套统一、简洁的接口（如提交命令、等待、挂起、恢复），将上层的调度**策略**与底层的硬件**机制**彻底解耦。这意味着，开发者可以编写一次调度策略，就能让它在不同厂商、不同代际的 XPU 上通用，大大降低了开发和维护成本。

2️⃣ 多级硬件能力模型 🛠️

我们深知 XPU 的硬件能力千差万别。为此，我们设计了一个三级抢占能力模型，像一块“罗塞塔石碑”，让 XSched 能与任何 XPU 高效“对话” 。

- **Lv1 (抢占排队命令)**：适配所有 XPU，移植成本极低（通常仅需几百行 C++ 代码），保证了最广泛的通用性。
- **Lv2 (抢占飞行中命令)**：利用更强的硬件能力，主动抢占已发射但未执行的命令，大幅降低抢占延迟。我们在 Intel NPU 上实现了硬件原生的 Lv2 抢占支持，同时还为 NVIDIA GPU 实现了基于二进制插桩的抢占技术，兼容闭源驱动和应用框架。
- **Lv3 (抢占执行中命令)**：最为先进的硬件设计，可中断正在执行的命令，实现微秒级的超低延迟抢占。XSched 也是首次在 NVIDIA GPU 上利用中断和 Trap 机制实现任务抢占和调度。

目前，XSched 已经通过该模型支持了来自 NVIDIA、AMD、Intel、昇腾、Xilinx 的十余款 XPU 设备，并且兼容 CUDA、HIP、oneAPI、OpenCL 等主流异构计算平台。这个多级模型不仅解决了当下的兼容性难题，更通过定义清晰的能力层级，为未来硬件的演进指明了方向。更多技术细节，欢迎大家深入阅读我们的论文。



XSched 不仅是一个学术原型，它在多个真实场景中都展示了巨大的应用价值：

- **☁️ 为云服务商降本增效**：在 GPU 多容器混合部署场景下，XSched 能在**不修改应用代码**（对客户透明）且**几乎不影响**（<1% 开销）高优客户性能的同时相比 SOTA 系统 TGS [NSDI'23]，多压榨出了 **2.74 倍**的 GPU 利用率，实现昂贵硬件的效率最大化。
- **🤖 为 AI 服务削减延迟**：只需**约 10 行代码**，XSched 就能集成到工业级的推理服务框架 NVIDIA Triton 中，并为其提供低延迟的 GPU 任务抢占能力，将高优先级请求的**尾延迟降低 1.41 倍**。同时，相比 SOTA 学术界推理系统 Paella [SOSP'23]，也能在高负载下取得 **1.3 倍的尾延迟降低**。
- **💻 为 AI PC 带来流畅体验**：对于运行在 [Intel Core Ultra NPU](https://www.intel.cn/content/www/cn/zh/products/details/processors/core-ultra.html) 上的智能视频会议应用，XSched 实现了一种基于 Deadline 的调度策略，保障语音转文字等前台任务的实时响应，同时让视频背景虚化等后台特效的帧处理延迟**显著降低 9.26 倍**，消除卡顿并提升用户体验。

我们还准备了 Demo 视频，直观展示 XSched 在多任务场景下的强大调度效果！

------

我们相信，XSched 是在抽象和管理异构算力方向上，解决 XPU 多任务调度挑战，并从“专用”走向“通用”的重要一步。我们非常期待与学术界和工业界的同行们交流、合作，共同构建下一代计算系统的基石。

**欢迎大家 Star、Fork、试用和共建！** 🙏

🔗 [Github](https://github.com/XpuOS/xsched) 📄 [论文直达](https://ipads.se.sjtu.edu.cn/_media/publications/xsched-osdi25.pdf)
